# name: "Terraform Vulnerability Scan"
# description: "Terraform scan for vulnerabilities and secrets"

# on:
#   push:
#     branches: [main, master]
#   pull_request:
#     types:
#       [opened, synchronize, reopened]
#   schedule:
#     - cron: "0 0 * * *"
#   workflow_dispatch:
#     inputs:
#       run_checkov_scan:
#         description: "Whether to run Checkov scan"
#         required: true
#         type: boolean
#         default: true
#       run_tfsec_scan:
#         description: "Whether to run TFSec scan"
#         required: true
#         type: boolean
#         default: true
#       run_trivy_scan:
#         description: "Whether to run Trivy scan"
#         required: true
#         type: boolean
#         default: true
#       run_snyk_scan:
#         description: "Whether to run Snyk scan"
#         required: false
#         type: boolean
#         default: false
#       ref:
#         description: 'Git ref to scan'
#         required: false
#         type: string
#         default: 'main'
#       directory_path:
#         description: 'Directory to scan'
#         required: false
#         type: string
#         default: '.'
#       fail_on_critical:
#         description: 'Fail workflow if critical vulnerabilities are found?'
#         required: false
#         type: boolean
#         default: true
#       iac-type:
#         description: "Required IaC type (cloudformation, terraform, kubernetes, all)"
#         required: false
#         type: string
#         default: "all"
#       checkov-download_external_modules:
#         description: "Whether to external terraform modules"
#         required: false
#         type: boolean
#         default: true
#       checkov-skip-check:
#         description: "Specific Checkov check_ids to skip"
#         required: false
#         type: string
#         default: ''
#       tfsec-exclude-ids:
#         description: "Specific TFSec check_ids to skip"
#         required: false
#         type: string
#         default: ''
#       snyk_severity_threshold:
#         description: "Fail if vulnerabilities at or above this severity exist (low|medium|high|critical)"
#         required: false
#         type: string
#         default: "high"
#       post_pr_comment:
#         description: 'Whether to post scan results as a PR comment'
#         required: false
#         type: boolean
#         default: true

# concurrency:
#   group: ${{ github.workflow }}-${{ github.ref }}
#   cancel-in-progress: true

# permissions:
#   contents: read
#   pull-requests: write

# jobs:
#   manual-security-scan:
#     if: github.event_name == 'workflow_dispatch'
#     uses: kariemoorman/github-reusable-workflows/.github/workflows/terraform_security_scan.yml@main
#     with:
#       run_trivy_scan: ${{ inputs.run_trivy_scan }}
#       run_checkov_scan: ${{ inputs.run_checkov_scan }}
#       run_tfsec_scan: ${{ inputs.run_tfsec_scan }}
#       run_snyk_scan: ${{ inputs.run_snyk_scan }}
#       ref: ${{ github.ref }}
#       directory_path: ${{ inputs.directory_path }}
#       fail_on_critical: ${{ inputs.fail_on_critical }}
#       iac-type: ${{ inputs.iac-type }}
#       checkov-download_external_modules: ${{ inputs.checkov-download_external_modules }}
#       checkov-skip-check: ${{ inputs.checkov-skip-check }}
#       tfsec-exclude-ids: ${{ inputs.tfsec-exclude-ids }}
#       snyk_severity_threshold: ${{ inputs.snyk_severity_threshold }}
#       post_pr_comment: ${{ inputs.post_pr_comment }}
#     secrets:
#       github-token: ${{ secrets.GITHUB_TOKEN }}
#       snyk-token: ${{ secrets.SNYK_TOKEN }}

#   automated-security-scan:
#     if: github.event_name != 'workflow_dispatch'
#     uses: kariemoorman/github-reusable-workflows/.github/workflows/terraform_security_scan.yml@main
#     with:
#       run_trivy_scan: true
#       run_checkov_scan: true
#       run_tfsec_scan: true
#       run_snyk_scan: true
#       ref: ${{ github.ref }}
#       directory_path: '.'
#       fail_on_critical: true
#       iac-type: 'all'
#       checkov-download_external_modules: true
#       checkov-skip-check: ''
#       tfsec-exclude-ids: ''
#       snyk_severity_threshold: 'high'
#       post_pr_comment: true
#     secrets:
#       github-token: ${{ secrets.GITHUB_TOKEN }}
#       snyk-token: ${{ secrets.SNYK_TOKEN }}


